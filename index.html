<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saskia's Physics Archvive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap"
        rel="stylesheet">
    
    <link rel="stylesheet" href="styles/a11y-light.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script>hljs.highlightAll();</script>
    <style>

        body {
            margin: 0;
            font-family: "Crimson Text", serif;
            font-weight: 400;
            font-style: normal;
            background-color: #ffffff;
            transition: background-color 0.3s, color 0.3s;
            padding-top: 50px;
        }

        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: "Courier New", monospace;
        }

        body.dark {
            background-color: #121212;
            color: #f0f0f0;
        }

        h2 {
            font-size: 2rem;
            color: hsl(235, 81%, 59%);
            display: block;  /* Make it full width */
            width: 80%;  /* Adjust width */
            max-width: 900px;  /* Optional: Set a maximum width */
        }

        nav {
            background-color: #f7f7f7;
            width: 250px;
            height: 100vh;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            font-weight: normal;
            transition: background-color 0.3s;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #sidebar {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 60px; /* Extra space at the bottom for better scrolling */
        }

        nav.dark {
            background-color: #333;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav ul li {
            margin: 15px 0;
            cursor: pointer;
        }

        nav ul li a {
            text-decoration: none;
            color: black;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        nav ul li a:active,
        nav ul li a:focus {
            color: hsl(235, 81%, 59%);
            outline: none;
        }

        nav ul li a.clicked {
            color: hsl(235, 81%, 59%);
        }

        /* This rule is no longer needed as we're using the more specific rule above */
        /* nav ul li a.dark {
            color: #f0f0f0;
        } */

        /* Dark mode styles for all icons */
        body.dark .icon,
        body.dark .fab,
        body.dark .fas,
        body.dark nav ul li a {
            color: #f0f0f0 !important;
        }
        
        /* Ensure GitHub icon is white in dark mode */
        /* GitHub icon styles */
        .fab.fa-github {
            color: #000000;  /* Black in light mode */
        }
        
        body.dark .fab.fa-github {
            color: #f0f0f0 !important;  /* White in dark mode */
        }

        nav ul .submenu {
            display: none;
            padding-left: 20px;
            font-weight: normal;
            font-size: 1.2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #f0f0f0;
            /* box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); */
            position: fixed;
            height: auto;
            top: 0;
            width: 97%;

            z-index: 10;
            transition: background-color 0.3s;
        }

        header.dark {
            background-color: #333;
        }

        header .left ul,
        header .right ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 15px;
        }

        header .left ul li,
        header .right ul li {
            font-size: 1rem;
            cursor: pointer;
        }

        .icon {
            font-size: 20px;
            cursor: pointer;
        }

        .container {
            margin-left: 50px;
            padding-top: 60px;
            padding: 20px;
        }

        /* Limit article width for better readability */
        #main-container {
            max-width: 1200px; /* adjust this value if you want wider/narrower text */
            margin-right: 40px; /* keep a right gutter when sidebar is visible */
            box-sizing: border-box;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .content {
            font-size: 1.2rem;
            flex: 1;
            width: 70%;
            text-align: left;
            padding-top: 40px;
            margin-right: 100px;
            max-width: 50%;
        }

        .image {
            flex: 1;
            min-width: 200px;
            text-align: center;  /* ✅ Centers contents inside this column */
            position: relative;  /* allows child relative offsets to make sense */
        }

        .main-content h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .main-content p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .profile-image {
            margin-top: -650px; 
            margin-left: -200px;
        }

        .profile-image img {
            width: 200px;
            max-width: 100%;
            border-radius: 100%;
            margin-bottom: 10px;
        }

        .image .social-icons {
            display: flex;
            justify-content: center;  /* ✅ centers icons horizontally */
            align-items: center;
            margin-top: 0px;
            position: relative;
            left: -100px; /* keep same offset as your profile-image */
        }



        .social-icons a {
            margin: 10px;
            font-size: 1.5rem;
            text-decoration: none;
            color: black;
            display: inline-block;
            transition: color 0.3s;
        }

        .social-icons a:hover {
            color: hsl(235, 81%, 59%);
        }

        .language-toggle {
            display: flex;
            align-items: left;
            gap: 0px;
            /* Reduce the gap between buttons */
        }

        .language-toggle button {
            background: none;
            border: none;
            font-size: 16px;
            color: black;
            cursor: pointer;
            transition: color 0.3s;
        }

        .language-toggle button.active {
            color: hsl(234, 12%, 47%);
        }

        footer {
            text-align: center;
            margin-top: 200px;
            font-size: 0.9rem;
            color: #888;
        }

        a {
            text-decoration: none;
        }

        .search-container {
            position: relative;
            display: flex;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .search-container::before {
            content: '\f002';
            font-family: 'Font Awesome 5 Free';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 12px;
            z-index: 1002;
            pointer-events: none;
            transition: all 0.2s ease;
        }

        #searchWrapper {
            position: fixed;
            top: 6px;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            width: 800px;
            max-width: 85%;
            display: none;
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        #searchWrapper.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        #searchBox {
            width: 100%;
            padding: 5px 12px 5px 30px;
            border: 1px solid #e0e0e0;
            border-radius: 18px;
            font-size: 13px;
            font-family: "Crimson Text", serif;
            background: white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
            transition: all 0.2s ease;
            outline: none;
            height: 30px;
            box-sizing: border-box;
            position: relative;
        }

        #searchBox:focus {
            transform: scale(1.02);
            border-color: hsl(235, 81%, 59%);
            box-shadow: 0 2px 12px rgba(94, 114, 228, 0.15);
        }

        #searchWrapper.show {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        #searchResults {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: white;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #eaeaea;
            width: 100%;
            box-sizing: border-box;
        }

        .search-result {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f5f5f5;
            font-size: 15px;
            color: #333;
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .search-result:hover {
            background-color: #f8f9ff;
            color: hsl(235, 81%, 59%);
            padding-left: 25px;
        }

        /* Dark mode styles */
        .dark #searchBox {
            background-color: #2d2d2d;
            border-color: #444;
            color: #f0f0f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .dark #searchBox:focus {
            border-color: hsl(235, 81%, 59%);
        }

        .dark #searchBox::placeholder {
            color: #888;
        }

        .dark #searchResults {
            background: #333;
            border-color: #444;
        }

        .dark .search-result {
            color: #e0e0e0;
            border-bottom-color: #444;
        }

        .dark .search-result:hover {
            background-color: #3a3a4a;
        }

        .dark .search-result-title {
            color: #8a9eff;
        }

        .dark .search-result-snippet {
            color: #b3b3b3;
        }

        .dark mark {
            background-color: #fff3cd;
            padding: 0 2px;
            border-radius: 2px;
        }

        #searchBox.show {
            display: block;
            opacity: 1;
            visibility: visible;
        }


        #header.active {
            margin-left: 260px;
            left: 30px;
            width: calc(100% - 330px);
        }

        @media (max-width: 768px) {
            nav {
                position: relative;
                width: 100%;
                height: auto;
                overflow: visible;
            }

            header {
                left: 0;
                width: 93%;
            }

            .container {
                margin-left: 0;
            }

            .main-content {
                flex-direction: column;
                align-items: center;
            }

            .content,
            .image {
                text-align: center;
            }

            .content {
                order: 2;
            }

            h2 {
                margin: 0;
            }

            .sidebar ul li a {
                text-decoration: none;
                color: #007bff;
                font-size: 19.2px;
            }

        }

        #sidebar {
            width: 250px;
            position: fixed;
            left: -300px;
            /* Initially hidden */
            top: 0;
            height: 100%;
            transition: left 0.3s ease-in-out;
        }

        #sidebar.active {
            left: 0;
            /* Slide in when active */
        }

        #menu-toggle {
            top: 10px;
            left: 10px;
            cursor: pointer;
            color: #000;
            border-radius: 5px;
        }

        .submenu {
            display: none;
        }

        .submenu.active {
            display: block;
        }

        #sidebar.active+#main-container {
            margin-left: 350px;
        }

        .container.active #header {
            margin-left: 350px;
        }

        mark {
            background-color: yellow;
        }
        
        #sidebar h1 {
            color: hsl(235, 81%, 59%);  /* Matching the h2 color */
            transition: color 0.3s ease;
        }
        
        #sidebar h1:hover {
            color: #1a237e;  /* Deep blue color */
        }
    </style>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js">
        </script>
    <script type="text/javascript">
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>

<body>

    <header id="header">
        <div class="left">
            <ul>
                <li id="menu-toggle"><i class="fas fa-bars icon" title="Menu"></i></li>
                <li><i class="fas fa-adjust icon" title="Toggle Dark/Light Mode" onclick="toggleDarkMode()"></i></li>
                <li class="search-container">
                    <i class="fas fa-search icon" id="searchIcon" title="Search"></i>
                </li>
            </ul>
        </div>
        
        <!-- Search wrapper will be positioned absolutely -->
        <div id="searchWrapper">
            <input type="text" id="searchBox" placeholder="Search articles..." autocomplete="off">
            <div id="searchResults"></div>
        </div>
        <div class="right">
            <ul>
                <li><i class="fas fa-print icon" title="Print" onclick="window.print()"></i></li>
                <li><a href="https://github.com/saskiapoldmaa/COSMOSS" target="_blank"><i class="fab fa-github icon" title="GitHub"></i></a>
                </li>
            </ul>
        </div>
    </header>

    <nav id="sidebar">
        <a href="index.html">
            <h1 id="sidebar-title">Saskia's Physics Archive</h1>
        </a>
        <ul>
            <li onclick="toggleSubmenu('submenu3')" style="font-size: 1.2rem;" >Signals → Particles</li>
            <ul id="submenu3" class="submenu">
                <li><a href="#" onclick="loadArticle('trigger.md')">1. Trigger</a></li>
                <!-- <li><a href="#" onclick="loadArticle('cherenkov.md')">5. Cherenkov detectors</a></li> -->
                <li><a href="#" onclick="loadArticle('qdc.md')">5. QDCs and Charge Measurements</a></li>
                <li><a href="#" onclick="loadArticle('dwc.md')">6. Delay Wire Chambers</a></li>
                <li><a href="#" onclick="loadArticle('nim.md')">7. Capturing Signals</a></li>
                <li><a href="#" onclick="loadArticle('daq.md')">8. Data Processing</a></li>
                <li><a href="#" onclick="loadArticle('randomcoinc.md')">9. Statistical Noise</a></li>
                </li>
            </ul>
            <li onclick="toggleSubmenu('submenu0')" style="font-size: 1.2rem;">Bytes → Physics</li>
            <ul id="submenu0" class="submenu">
                <li><a href="#" onclick="loadArticle('tut1.md')">1. First steps in ROOT</a></li>
                <li><a href="#" onclick="loadArticle('tut11.md')">2. Real Data!</a></li>
                <li><a href="#" onclick="loadArticle('tut2.md')">3. Working With Raw Data</a></li>
                <li><a href="#" onclick="loadArticle('tut3.md')">4. Charge Measurements</a></li>
                <li><a href="#" onclick="loadArticle('tut4.md')">5. Track Reconstruction</a></li>
                <li><a href="#" onclick="loadArticle('identification.md')">6. Distinguishing Particles</a></li>
                <li><a href="#" onclick="loadArticle('beamprofile.md')">7. Beam Dynamics</a></li>
                <li><a href="#" onclick="loadArticle('landau.md')">8. Spectra and Landau distributions </a></li>
            </ul>
            <!-- <li onclick="toggleSubmenu('submenu4')" style="font-size: 1.2rem;">Advice</li>
            <ul id="submenu4" class="submenu">
                <li><a href="#" onclick="loadArticle('resources.md')">1. Resources</a></li>
                <li><a href="#" onclick="loadArticle('academic.md')">2. Entering the Academic World</a></li>
            </ul> -->
            <li><a href="?show=challenge.md" style="text-decoration: none; color: inherit;">Problem Collection</a></li>
            <!-- <li onclick="toggleSubmenu('simulations')" style="font-size: 1.2rem; cursor: pointer;">Interactive Simulations</li> -->
            <ul id="simulations" class="submenu" style="display: none;">
                <li><a href="#" onclick="loadSimulation('simulations/electric-potential/index.html')">1. Electric Potential</a></li>
                <!-- Add more simulations here as they're created -->
            </ul>
            <li><a href="?show=article.md" style="text-decoration: none; color: inherit;">Beamtest Results</a></li>
            <li><a href="?show=CV.md" style="text-decoration: none; color: inherit;">CV</a></li>
            <!-- <li><a href="#" onclick="loadSimulation('../articles/imagemethod.html')">Image Method</a></li> -->
        </ul>
    </nav>




    <div class="container" id="main-container">
        <div class="main-content">
            <div class="content">
            <h1 id="main-heading" style="margin-top: 70px">Hi! I’m Saskia — a physics student at MIT.</h1>

            <p style="margin-bottom: 30px;">
                This site collects some of the projects I’ve worked on and the insights I've gained from them. 
            </p>
            <p>
                My latest addition is <a href="https://wigner.onrender.com/">The Wigner Plotter</a>, an interactive tool to visualize how any operator acts on the QHO ground state.  
            </p>

            <iframe
                src="https://wigner.onrender.com/"
                width="1000"
                height="600"
                style="margin-top: 20px; border-radius: 8px; border: none;"
            ></iframe>
            <p>
                <a href="https://wigner.onrender.com/">https://wigner.onrender.com/</a>
            </p>

            <p>I've also written learning materials for anyone wishing to dive into experimental particle physics. These have been compiled from my time experimenting with <a href="https://isef.net/project/phys003-balloon-borne-muon-flux-studies">homemade muon detectors</a> and conducting a small-scale experiment at CERN, thanks to the <a href="https://beamlineforschools.cern/">Beamline for Schools Competition</a></p>
            <ul>
                <li>
                <strong>Signals → Particles:</strong> discusses the experimental side, introducing various detectors and data acquisition techniques.
                <li>
                <strong>Bytes → Physics:</strong> includes data analysis tutorials using ROOT — the go-to software, used everywhere from at-home experiments to the LHC. 
                </li>
                <li>
                <strong>Problem Collection:</strong> some of my favorite physics olympiad problems.
            </ul>

            <p style="margin-top: 40px; font-size: 0.95rem; color: #666;">
                Last updated: <span id="lastUpdated"></span>
            </p>
            </div>

            <div class="image">
            <div class="profile-image">
                <img src="articles/images/nunnupilt.jpg" alt="Profile Image">
            </div>
            <div class="social-icons">
                <a href="mailto:saskia.poldmaa@gmail.com" style="color: rgb(139, 139, 189);" title="Email">
                <i class="fas fa-envelope"></i>
                </a>
                <a
                href="https://ee.linkedin.com/in/saskia-p%C3%B5ldmaa-2a3b72266"
                style="color: rgb(139, 139, 189);"
                target="_blank"
                title="LinkedIn"
                >
                <i class="fab fa-linkedin"></i>
                </a>
            </div>
            </div>
        </div>
        </div>


    <footer>Saskia Põldmaa, 2025</footer>

    <script>
        // Get the last modified date of the document
        const lastUpdated = new Date(document.lastModified);

        // Format the date as "Month Day, Year" (e.g., "January 26, 2025")
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = lastUpdated.toLocaleDateString("en-US", options);

        // Insert the formatted date into the footer
        document.getElementById("lastUpdated").textContent = formattedDate;

        let isDarkMode = false;

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle("dark", isDarkMode);
            document.getElementById("sidebar").classList.toggle("dark", isDarkMode);
            document.querySelector("header").classList.toggle("dark", isDarkMode);
        }

        function switchHeader() {
            document.querySelector('header').outerHTML = `
                <header>
                    <div>
                        <a class="fas fa-print icon" title="Print" onclick="window.print()"></a>
                        <a href="https://github.com" target="_blank"><i class="fab fa-github icon github" title="GitHub"></i></a>
                    </div>
                </header>`;
        }

        document.querySelectorAll('#submenu1 li a').forEach(link => {
            link.addEventListener('click', function (event) {
                if (!this.href.includes("new.html")) {
                    event.preventDefault();
                }

                document.querySelectorAll('#submenu1 li a').forEach(el => el.classList.remove('clicked'));
                this.classList.add('clicked');
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const show = params.get('show');
        
            if (show) {
                if (show.endsWith('.md')) {
                    loadArticle(show);
                } else if (show.endsWith('.html')) {
                    loadSimulation(show);
                } else {
                    console.error("Unsupported file type:", show);
                }
            }
        };
        
        async function loadArticle(article) {
            try {
                const response = await fetch(`articles/${article}`);
                if (!response.ok) throw new Error("Article not found");
                const text = await response.text();
                const parsedContent = marked.parse(text);
                const container = document.getElementById('main-container');
        
                // Inject article content
                container.innerHTML = parsedContent;
        
                // Apply syntax highlighting
                document.querySelectorAll('#main-container pre code').forEach((block) => {
                    block.classList.add("language-python");
                    hljs.highlightElement(block);
                });
        
                // Ensure MathJax renders the new content
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }
            } catch (error) {
                console.error("Error loading article:", error);
            }
        }
        
        async function loadSimulation(simulation) {
            try {
                const container = document.getElementById('main-container');
                container.innerHTML = `
                    <div style="width: 100%; height: 800px;">
                        <iframe src="${simulation}" style="width: 100%; height: 100%; border: none; border-radius: 8px;"></iframe>
                    </div>
                `;
            } catch (error) {
                console.error("Error loading simulation:", error);
                const container = document.getElementById('main-container');
                container.innerHTML = `
                    <div style="padding: 20px; color: red;">
                        <h2>Error loading simulation</h2>
                        <p>${error.message}</p>
                        <p>Please try again or check the console for more details.</p>
                    </div>
                `;
            }
        }
    </script>



    <script>
        // Function to toggle sidebar and adjust header margin
        document.addEventListener("DOMContentLoaded", function () {
            var sidebar = document.getElementById("sidebar");
            var header = document.getElementById("header");

            // Ensure sidebar is visible on initial load
            sidebar.classList.add("active");
            header.classList.add("active");
        });

        document.getElementById("menu-toggle").addEventListener("click", function () {
            var sidebar = document.getElementById("sidebar");
            var header = document.getElementById("header");

            // Toggle sidebar visibility
            sidebar.classList.toggle("active");

            // Adjust header margin based on sidebar state
            header.classList.toggle("active");
        });

        // Function to toggle submenus
        function toggleSubmenu(submenuId) {
            var submenu = document.getElementById(submenuId);
            if (submenu.style.display === 'block') {
                submenu.style.display = 'none';
            } else {
                submenu.style.display = 'block';
            }
            // Also toggle active class for styling if needed
            submenu.classList.toggle("active");
            
            // Prevent the click from propagating to parent elements
            event.stopPropagation();
        }
    </script>


    <script>
        // Initialize search functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const searchIcon = document.getElementById('searchIcon');
            const searchWrapper = document.getElementById('searchWrapper');
            const searchBox = document.getElementById('searchBox');
            
            // Toggle search box with animation
            searchIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (searchWrapper.classList.contains('show')) {
                    searchWrapper.classList.remove('show');
                    setTimeout(() => {
                        searchWrapper.style.display = 'none';
                    }, 300);
                } else {
                    searchWrapper.style.display = 'block';
                    // Trigger reflow
                    void searchWrapper.offsetWidth;
                    searchWrapper.classList.add('show');
                    searchBox.focus();
                }
            });
            
            // Close search when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchWrapper.contains(e.target) && e.target !== searchIcon) {
                    searchWrapper.classList.remove('show');
                    setTimeout(() => {
                        searchWrapper.style.display = 'none';
                    }, 300);
                }
            });
            
            // Handle search input
            searchBox.addEventListener('input', function() {
                searchArticles(this.value);
            });
            
            // Close on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && searchWrapper.classList.contains('show')) {
                    searchWrapper.classList.remove('show');
                    setTimeout(() => {
                        searchWrapper.style.display = 'none';
                    }, 300);
                }
            });
        });

        // Cache for article content
        const articleCache = new Map();
        
        // Fetch article content
        async function fetchArticleContent(article) {
            if (articleCache.has(article.path)) {
                return articleCache.get(article.path);
            }
            
            try {
                const response = await fetch(article.path);
                if (!response.ok) {
                    console.error(`Failed to fetch ${article.path}: ${response.status} ${response.statusText}`);
                    return '';
                }
                const content = await response.text();
                // Clean the content for better search results
                const cleanContent = content
                    .replace(/^#.*$/gm, '')  // Remove headers
                    .replace(/```[\s\S]*?```/g, '')  // Remove code blocks
                    .replace(/`[^`]+`/g, '')  // Remove inline code
                    .replace(/!\[.*?\]\(.*?\)/g, '')  // Remove images
                    .replace(/\[(.*?)\]\(.*?\)/g, '$1')  // Remove markdown links but keep link text
                    .replace(/[\n\r]+/g, ' ')  // Normalize whitespace
                    .replace(/\s+/g, ' ')  // Replace multiple spaces with single space
                    .trim();
                
                articleCache.set(article.path, cleanContent);
                return cleanContent;
            } catch (error) {
                console.error(`Error loading article ${article.path}:`, error);
                return '';
            }
        }

        // Get a snippet of text around the first match
        function getSnippet(text, query, maxLength = 150) {
            if (!text) return '';
            
            const index = text.toLowerCase().indexOf(query.toLowerCase());
            if (index === -1) return '';
            
            const start = Math.max(0, index - 50);
            const end = Math.min(text.length, index + maxLength);
            let snippet = text.substring(start, end);
            
            if (start > 0) snippet = '...' + snippet;
            if (end < text.length) snippet = snippet + '...';
            
            // Highlight the query in the snippet
            const regex = new RegExp(`(${query})`, 'gi');
            return snippet.replace(regex, '<mark>$1</mark>');
        }

        async function searchArticles(query) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (!query) {
                resultsContainer.innerHTML = '';
                return;
            }

            const results = [];
            
            // Search through all articles
            for (const article of articles) {
                const content = await fetchArticleContent(article);
                const titleMatch = article.title.toLowerCase().includes(query.toLowerCase());
                const contentMatch = content.toLowerCase().includes(query.toLowerCase());
                
                if (titleMatch || contentMatch) {
                    results.push({
                        ...article,
                        content: content,
                        isTitleMatch: titleMatch,
                        contentSnippet: getSnippet(content, query)
                    });
                }
            }

            resultsContainer.innerHTML = '';

            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="search-result">No results found</div>';
                return;
            }

            results.forEach(article => {
                const result = document.createElement('div');
                result.className = 'search-result';
                
                // Highlight title matches
                let titleHTML = article.title;
                if (article.isTitleMatch) {
                    const regex = new RegExp(`(${query})`, 'gi');
                    titleHTML = article.title.replace(regex, '<mark>$1</mark>');
                }
                
                result.innerHTML = `
                    <div class="search-result-title">${titleHTML}</div>
                    ${article.contentSnippet ? `<div class="search-result-snippet">${article.contentSnippet}</div>` : ''}
                `;
                
                result.onclick = function() {
                    loadArticle(article.path);
                    document.getElementById('searchWrapper').style.display = 'none';
                };
                resultsContainer.appendChild(result);
            });
        }

        const articles = [
            { title: 'Trigger', path: 'articles/trigger.md' },
            //{ title: 'Jets', path: 'articles/jets.md' }, //
            //{ title: 'Feynman Diagrams', path: 'articles/feynman.md' }, //
            { title: 'Charge Measurements', path: 'articles/qdc.md' },
            { title: 'Delay Wire Chambers', path: 'articles/dwc.md' },
            { title: 'Recording Data', path: 'articles/nim.md' },
            { title: 'Data Processing', path: 'articles/daq.md' },
            { title: 'Statistical Noise', path: 'articles/randomcoinc.md' },
            { title: 'Monte Carlo Simulations', path: 'articles/montecarlo.md' },
            { title: 'ROOT Setup and First Example', path: 'articles/tut1.md' },
            { title: 'Working With Raw Data', path: 'articles/tut2.md' },
            { title: 'The intricacies of charge measurements', path: 'articles/tut3.md' },
            { title: "Where's the particle?", path: 'articles/tut4.md' },
            { title: 'Identify Particles in the Beam', path: 'articles/identification.md' },
            { title: 'How Does the Beam Even Look like?', path: 'articles/beamprofile.md' },
            { title: 'Deriving spectra – how are Landau distributions generated?', path: 'articles/landau.md' },
            { title: 'Getting to work with REAL data! ', path: 'articles/tut11.md' }
        ];

        // Debounce search to avoid too many requests
        let searchTimeout;
        document.getElementById('searchBox').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            searchTimeout = setTimeout(() => searchArticles(query), 300);
        });
        
        // Pre-fetch article contents when search is focused
        document.getElementById('searchBox').addEventListener('focus', async () => {
            // Start loading a few articles in the background
            const popularArticles = articles.slice(0, 5);
            await Promise.all(popularArticles.map(article => fetchArticleContent(article)));
        });
    </script>

    <script>
        function highlightText() {
            let input = document.getElementById("searchBox").value.trim();
            let container = document.getElementById("main-container");

            function removeHighlight(node) {
                if (node.nodeType === 3) { // Text node
                    node.parentNode.innerHTML = node.parentNode.innerHTML.replace(/<mark>(.*?)<\/mark>/gi, "$1");
                } else {
                    node.childNodes.forEach(removeHighlight);
                }
            }

            function applyHighlight(node) {
                if (node.nodeType === 3) { // Text node
                    let text = node.nodeValue;
                    let regex = new RegExp(`(${input})`, "gi");
                    if (input !== "" && text.match(regex)) {
                        let highlighted = text.replace(regex, "<mark>$1</mark>");
                        let span = document.createElement("span");
                        span.innerHTML = highlighted;
                        node.replaceWith(span);
                    }
                } else {
                    node.childNodes.forEach(applyHighlight);
                }
            }

            removeHighlight(container);
            if (input !== "") applyHighlight(container);
        }

        function clearHighlight() {
            document.getElementById("searchBox").value = "";
            highlightText(); // Removes highlights by resetting text
        }

    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });
    });
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('pre code').forEach((block) => {
            block.classList.add("language-python");  // Auto-fix missing classes
            hljs.highlightElement(block);
        });
    });
    </script>


</body>

</html>
